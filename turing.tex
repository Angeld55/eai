\chapter{Машини на Тюринг}

\newcommand{\tape}[1]{\dots\blank\blank\blank{#1}\blank\blank\blank\dots}

\section{Основни понятия}
\index{Тюринг}
\marginpar{Дефиницията в \cite{sipser} е по-различна. Там има две финални състояния - $q_{accept}$ и $q_{reject}$}
Машина на Тюринг ще наричаме седморка от вида $\M = \TM$, където:
\marginpar{Sipser дава малко по-различна дефиниция - с едно финално приемащо и едно финално отхвърлящо.}
\begin{itemize}
\item 
  $Q$ - състояния;
\item
  $\Sigma$ - азбука за входа;
\item
  $\Gamma$ - азбука за лентата, $\Sigma \subseteq \Gamma$;
\item
  $\delta:Q\times\Gamma \to Q\times \Gamma \times \{L,R,N\}$ - (частична) функция на преходите;
\item
  $s$ - начално състояние, $s \in Q$;
\item
  $\blank$ - празен символ,  $\blank \in \Gamma \setminus \Sigma$;
\item
  $F$ - финални състояния, $F \subseteq Q$.
\end{itemize}

Сега ще опишем как $\M$ работи върху вход думата $\alpha \in \Sigma^\star$.
Първоначално, безкрайната лента съдържа само $\alpha$. Останалите клетки на лентата съдържат $\blank$.
Освен това, $\M$ се намира в началното състояние $s$ и главата е върху най-левия символ на $\alpha$.
Работата $\M$ е описана от функцията на преходите.
  
\marginpar{(На англ. instanteneous description)}
{\em Моментното описание} (или конфигурацията) на едно изчисление на МТ е тройка от вида $(\alpha, q, \beta) \in \Gamma^\star\times Q \times \Gamma^\star$. Това означава, че
машината се намира в състояние $q$ и лентата има вида
\[\tape{\alpha\beta},\]
като главата на мишната е поставена върху първия символ на $\beta$.

Както за автомати, удобно е да дефинираме бинарна релация $\vdash_\M$,
която ще казва как моментното описание на машината $\M$ се променя при 
изпълнение на една стъпка от изчислението.
\begin{itemize}
\item
  Ако $\delta_\M(q,Z) = (p,Y,R)$, то $(\alpha, q, Z\beta) \vdash_\M (\alpha Y, p, \beta)$.
  При $Z = \blank$, също така можем да запишем 
  $(\alpha, q, \varepsilon) \vdash_\M (\alpha Y, p, \varepsilon)$
\item 
  Ако $\delta_\M(q,Z) = (p,Y,L)$, то $(\alpha X, q, Z\beta) \vdash_\M (\alpha , p, XY\beta)$.
  При $X = \blank$, имаме $(\varepsilon, q, Z\beta) \vdash_\M (\varepsilon, p, \blank Y\beta)$.
\item
  Ако $\delta_\M(q,Z) = (p,Y,N)$, то ....
\end{itemize}
С $\vdash^\star_\M$ ще означаваме рефлексивното и транзитивно затваряне на $\vdash_\M$.

Езикът, който се {\bf разпознава чрез финални състояния} от машината $M$ е:
\[\L_F(\M) = \{\alpha\in\Sigma^\star \mid (\varepsilon, s, \alpha) \vdash^\star (\beta, q, \gamma)\ \&\ q\in F\ \&\ \beta,\gamma\in\Gamma^\star\}.\]

\marginpar{Това трябва ли ми ?}
Езикът, който се {\bf разпознава чрез спиране} от $M$ е:
\[\L_H(\M) = \{\alpha \in \Sigma^\star \mid (\varepsilon, s, \alpha) \vdash^\star (\beta, q, X\gamma)\ \&\ \neg !\delta(q,X)\}\]

Може да се докаже, че се разпознават едни и същи езици.

\index{език!полуразрешим}
Езиците, които се разпознават от МТ се наричат {\bf полуразрешими езици}.
\index{език!разрешим}
Един език $L$ се нарича разрешим, ако за него съществува $\M$, $L = \L_F(\M)$
и освен това $\M$ завършва върху всички входни думи.

\section{Примери}

\subsection*{Полуразрешим език, който не е безконтекстен}

\begin{example}
  \marginpar{Знаем, че $L$ не е безконтекстен}
  Да разгледаме езика $L = \{a^nb^nc^n \mid n\in\Nat\}$.
  Ще построим машина на Тюринг $\M$, за която $L = \L(\M)$.
  \begin{figure}[H]
    \begin{center}
      \begin{tikzpicture}[->,>=stealth,thick,node distance=50pt]
        \tikzstyle{every state}=[circle,minimum size=10pt,auto,scale=.9]
        
        \node[state,initial]    (1) {$1$};
        \node[state]            (2) [right of=1]{$2$};
        \node[state]            (3) [right of=2]{$3$};
        \node[state]            (4) [right of=3]{$4$};
        \node[state,accepting]  (5) [below of=1]{$5$};
        
        \begin{scope}[every node/.style={scale=.8}]
          \path
          (1) edge [loop above] node [above] {$d;R$} (1)
          (1) edge node [left] {$\blank;N$} (5)
          (1) edge [bend left=15] node [above] {$a/d;R$} (2)
          (2) edge [bend left=15] node [above] {$b/d;R$} (3)
          (2) edge [loop above] node [above] {$\{a,d\};R$} (2)
          (3) edge [bend left=15] node [above] {$c/d;L$} (4)
          (3) edge [loop above] node [above] {$\{b,d\};R$} (3)
          (4) edge [loop above] node [above] {$\{a,b,d\};L$} (4)
          (4) edge [bend left=30] node [below] {$\blank;R$} (1);
        \end{scope}
      \end{tikzpicture}
    \end{center}
  \end{figure}

  Да проследим изчислението на думата $aabbcc$:
  
  \[_1aabbcc \vdash d_2abbcc \vdash da_2bbcc \vdash dad_3bcc \vdash dadb_3cc \vdash dad_4bdc \vdash da_4dbdc \vdash \cdots \vdash\]
  \[_4dadbdc \vdash\ _4\blank dadbdc \vdash\ _1dadbdc \vdash d_1adbdc \vdash dd_2dbdc \vdash ddd_2bdc \vdash dddd_3dc \vdash \]
  \[ ddddd_3c \vdash dddddd_4 \vdash \cdots \vdash\ _4\blank dddddd \vdash\ _1dddddd \vdash \cdots \vdash dddddd_1\blank \vdash dddddd_5\blank.\]
\end{example}

\begin{example}
  Да разгледаме езика $L = \{\omega c \omega \mid \omega\in\{a,b\}^\star\}$.
  Ще построим машина на Тюринг $\M$, за която $L = \L(\M)$.
  
  \begin{figure}[H]
    \begin{center}
      \begin{tikzpicture}[->,>=stealth,thick,node distance=50pt]
        \tikzstyle{every state}=[circle,minimum size=10pt,auto,scale=.9]
        
        \node[state,initial]    (1) {$1$};
        \node[state]            (2) [above right of=1]{$2$};
        \node[state]            (3) [below right of=1]{$3$};
        \node[state]            (4) [right of=2]{$4$};
        \node[state]            (5) [right of=3]{$5$};
        \node[state]            (6) [below right of=4]{$6$};
        \node[state]            (7) [above of=6]{$7$};
        \node[state]            (8) [left of=3]{$8$};
        \node[state,accepting]  (9) [below left of=3]{$9$};
        
        \begin{scope}[every node/.style={scale=.8}]
          \path
          (1) edge [bend left=15] node [right] {$a/x;R$} (2)
              edge [bend right=15] node [right] {$b/x;R$} (3)
              edge [bend right=15] node [left] {$c;R$} (8)
          (2) edge [loop above] node [above] {$\{a,b\};R$} (2)
              edge [bend left=15] node [above] {$c;R$} (4)
          (3) edge [loop below] node [below] {$\{a,b\};R$} (3)
              edge [bend right=15] node [below] {$c;R$} (5)
          (4) edge [loop above] node [above] {$x;R$} (4)
              edge [bend left=15] node [left] {$a/x;L$} (6)
          (5) edge [loop below] node [below] {$x;R$} (5)
              edge [bend right=15] node [right] {$b/x;L$} (6)
          (6) edge [loop right] node [right] {$\{a,b,x\};L$} (6)
              edge [bend right=15] node [right] {$c;L$} (7)
          (7) edge [loop right] node [right] {$\{a,b\};L$} (7)
              edge [out=130,in=120,above,distance=2.5cm] node [above] {$x;R$} (1)
          (8) edge [loop left] node [left] {$x;R$} (8)
              edge [bend right=15] node [left] {$\blank;N$} (9);
        \end{scope}
      \end{tikzpicture}
    \end{center}
  \end{figure}

  Да проследим изчислението на думата $abcab$.

\end{example}


\subsection*{Удвояване на броя на единиците}

\[\stackrel{1}{1}11\ \Rightarrow\ \stackrel{2}{\blank} 111\ \Rightarrow\ \stackrel{3}{\blank}\blank 111\ \Rightarrow\ \stackrel{4}{\blank}1\blank 111\ \Rightarrow\ 1\stackrel{5}{1}\blank 111\ \Rightarrow\  11\stackrel{5}{\blank}111\ \Rightarrow\  11 \blank \stackrel{6}{1}11\]
\[\dots \Rightarrow\ 11\blank 111\stackrel{6}{\blank}\ \Rightarrow\ 11\blank 11\stackrel{7}{1}\blank\ \Rightarrow\ 11\blank 1\stackrel{8}{1}\blank\blank\ \Rightarrow\ 11\blank \stackrel{9}{1}1\blank\blank\ \Rightarrow\  1\stackrel{10}{1}\blank 11\blank\blank\]
\[\dots \Rightarrow\ \stackrel{10}{\blank}11\blank 11\blank\blank\ \Rightarrow\ \stackrel{2}{1}1\blank 11\blank\blank\ \Rightarrow\ \cdots\]

\begin{figure}[H]
  \begin{center}
    \begin{tikzpicture}[->,>=stealth,thick,node distance=45pt]
      \tikzstyle{every state}=[circle,minimum size=10pt,auto,scale=.7]
      
      \node[state]   (1) {$1$};
      \node[state]            (2) [right of=1]{$2$};
      \node[state]            (3) [right of=2]{$3$};
      \node[state]            (4) [right of=3]{$4$};
      \node[state]            (5) [right of=4]{$5$};
      \node[state]            (6) [right of=5]{$6$};
      \node[state]            (7) [right of=6]{$7$};
      \node[state]            (8) [right of=7]{$8$};
      \node[state]            (9) [right of=8]{$9$};
      \node[state]            (10) [right of=9]{$10$};
      \node[state]            (11) [below of=8]{$11$};
      \node[state,accepting]  (12) [below of=11]{$12$};
      
      \begin{scope}[every node/.style={scale=.8}]
      \path
      (1) edge [bend left=15] node [above] {$1;L$} (2)
      (2) edge [bend left=15] node [above] {$1;L$} (3)
      (2) edge [bend right=15] node [below] {$\blank;L$} (3)
      % (3) edge [bend left=15] node [above] {$1/1;L$} (4)
      (3) edge [bend left=15] node [above] {$\blank/1;L$} (4)
      (4) edge [bend left=15] node [above] {$\blank/1;R$} (5)
      % (4) edge [bend right=15] node [below] {$1/1;R$} (5)
      (5) edge [loop below] node [below] {$1;R$} (5)
      (5) edge [bend left=15] node [above] {$\blank;R$} (6)
      (6) edge [loop below] node [below] {$1;R$} (6)
      (6) edge [bend left=15] node [above] {$\blank;L$} (7)
      (7) edge [bend left=15] node [above] {$1/\blank;L$} (8)
      % (7) edge [bend right=15] node [below] {$\blank;L$} (8)
      (8) edge [bend left=15] node [above] {$1;L$} (9)
      (9) edge [loop below] node [below] {$1;L$} (9)
      (9) edge [bend right=15] node [below] {$\blank;L$} (10)
      (10) edge [loop below] node [below] {$1;L$} (10)
      (10) edge [bend right=30] node [above] {$\blank;R$} (2)
      (8) edge [] node [right] {$\blank;L$} (11)
      (11) edge [loop left] node [left] {$1;L$} (11)
      (11) edge [] node [right] {$\blank;R$} (12);
      \end{scope}
    \end{tikzpicture}
  \end{center}
\end{figure}

\begin{problem}
  За произволно естествено число $n$, дефинирайте МТ $\M_n$ с $n+11$ състояние, за която,
  ако главата е на най-лявата $1$-ца върху блок от $1$-ци, то $\M_n$
  завършва като записва $2n$ единици на лентата и завършва в стандартна конфигурация.
\end{problem}


\subsection*{Канонична подредба на $\Sigma^\star$}

Нека $\Sigma = \{a_0,a_1,\dots,a_{k-1}\}$.
Подреждаме думите по ред на тяхната дължина.
Думите с еднаква дължина подреждаме по техния числов ред, т.е.
гледаме на буквите $a_i$ като числото $i$ в $k$-ична бройна система.
Тогава думите с дължина $n$ са числата от $0$ до $k^n-1$ записани в $k$-ична бройна система.
Ще означаваме с $\omega_i$ $i$-тата дума в $\Sigma^\star$ при тази подредба.

\begin{example}
  Ако $\Sigma = \{0,1\}$, то наредбата започва така:
  \[\varepsilon, 0, 1, \underbrace{00, 01, 10, 11}_{\text{от $0$ до $3$}}, \underbrace{000, 001, 010, 011, 100, 101, 110, 111}_{\text{от $0$ до $7$}}, 0000, 0001, \dots\]
  В този случай, $\omega_0 = \varepsilon$, $\omega_7 = 000$, $\omega_{13} = 110$.
\end{example}

\subsection*{Многолентови машини на Тюринг}

%Това е просто като имаш shift.
%Използват се при недет. машини

Машина на Тюринг с $k$ ленти има същата дефиниция като еднолентова МТ
с единствената разлика, че
\[\delta: Q^k \times \Gamma^k\to Q^k \times \Gamma^k \times \{L,R\}^k.\]

\begin{prop}
  За всяка $k$-лентова МТ $\M$ съществува еднолентова МТ $\M'$,
  такава че $\L(\M) = \L(\M')$.
\end{prop}
\begin{proof}
  $\Gamma' = \{\sharp\} \cup \Gamma \cup \{\hat{X} \mid X \in \Gamma\}$.
\end{proof}

\subsection*{Недетерминистични машини на Тюринг}

\begin{thm}
  Ако $L$ се разпознава от НМТ $\N$, до $L$
  също се разпознава и от ДМТ $\D$.
\end{thm}
\begin{proof}
  Понеже функцията $\Delta_\D$ е крайна, нека с $r$ да означим 
  максималния брой избори за следваща стъпка в произволно изчисление на $\D$.
  $\D$ има три ленти.
  \begin{itemize}
  \item 
    На първата лента съхраняваме входящия низ и тя никога не се променя.
  \item
    На втората лента помним мястото на $\D$ в дървото на недетерминистичните изчисления на $\N$.  
  \item
    На третата лента съхраняваме лентата на $\N$ за детерминистичното изчисление на $\N$, 
    определено от втората лента. Например, ако съдържанието на втората лента е $3,1,2$,
    това означава, че симулираме изчисление от три стъпки като на първата стъпка избираме третия 
    клон, на втората стъпка избираме първия клон, на третата стъпка избираме втория клон.
  \end{itemize}
\end{proof}


\subsection*{Полуразрешими и разрешими езици}

\begin{framed}
\begin{thm}[Пост]
  Ако $L$ и $\Sigma^\star \setminus L$ са полуразрешими езици, то $L$ е разрешим език.
\end{thm}
\end{framed}

% \subsection*{Busy Beaver}

% Тук разглеждаме азбука $\Sigma = \{1,\blank\}$.
% \marginpar{\cite{tibor-rado}}


\subsection*{Тезис на Чърч-Тюринг}

\section{Универсална машина на Тюринг}
За простота, нека $\Sigma = \{0,1\}$ и $\Gamma = \{0,1,\blank\}$.
\begin{itemize}
\item 
  $X_1 = 0$, $X_2 = 1$, $X_3 = \blank$;
\item
  $D_1 = L$, $D_2 = R$
\end{itemize}

\subsection*{Кодиране на преход}
Да разгледаме прехода $\delta(q_i,X_j) = (q_k,X_l,D_m)$.
Кодираме този преход по следния начин:
\[0^i10^j10^k10^l10^m\]
Да обърнем внимание, че в този двоичен код няма последователни единици и той 
започва и завършва с нула.
\subsection*{Кодиране на машина на Тюринг}
За да кодираме една машина на Тюринг $\M$ е достатъчно да кодираме функцията на преходите $\delta$.
Понеже $\delta$ е крайна функция, нека с числото $r$ да означим броя на всички възможни преходи.
По описания по-горе начин, нека $code_i$ е числото в двоичен запис, получено за $i$-тия преход на $\delta$.
Тогава кодът на $\M$ е следното число в двоичен запис:
\[\pair{\M} = 111\ code_1\ 11\ code_2\ 11\ \cdots\ 11\ code_r\ 111.\]
\begin{itemize}
\item
  Лесно се съобразява, че за две МТ $\M$ и $\M'$ с различни функции на преходите, имаме $\pair{\M} \neq \pair{\M'}$.
\item
  Ще казваме, че числото $r\in\Nat$ е {\bf код на} $\M$, ако $r$, записано в двоичен запис представлява думата $\pair{\M}$.
  Оттук нататък, когато пишем $\M_r$, ще имаме предвид машината на Тюринг с код $r$.
\item
  Ясно е, че не всяко естествено число е код на машина на Тюринг, но по дадено число $n$
  има ефективна процедура, която ни казва дали $n$ е код на машина на Тюринг или не.
\item
  С $\pair{\M,w}$ ще означаваме кода на МТ $\M$ при вход $w$ е числото с двоичен запис описанието на $\M$ и след това прикрепена думата $w$.
  При едно число $r = \pair{M,w}$, лесно се намира кода на $\M$.
  Просто започваме да четем двоичния запис на $r$ докато не срещнем за втори път $111$.
  След това започва думата $w$.
\end{itemize}


\section{Изчислими функции}

Нека е дадена функцията $f:\Nat^k \to \Nat$.
Ще казваме, че $f$ е изчислима с машината на Тюринг $\M$,
ако за всяко $n_1,\dots,n_k$ е изпълнено:
\begin{itemize}
\item 
  Представяме всяко от числата $n_1,\dots,n_k$ в монадична бройна система
  като лентата на $\M$ има вида:  
  \[\dots \blank \blank \underbrace{1111\dots 11}_{n} \blank\blank\dots,\]
  като изискваме главата на $\M$ да е позиционирана върху най-лявата единица.
  Такава конфигурация ще наричаме {\bf стандартна начална конфигурация}.
\item
  Ако $f(n_1,\dots,n_k) = m$, то $\M$ завършва с резултат върху лентата
  \[\dots \blank \blank \underbrace{1111\dots 11}_{m} \blank\blank\dots,\]
  като главата на $\M$ е върху най-лявата 1-ца.
  Такава конфигурация се нарича {\bf стандартна финална конфигурация}.
\item
  Ако $f(n_1,\dots,n_k)$ е недефенирана, то $\M$ няма да завърши в стандартна конфигурация, т.е.
  или $\M$ ще работи безкрайно време, или ще завърши в конфигурация, която не е стандартна.
\end{itemize}

% За фунция от вида $f:\Nat^k\to \Nat$, дефинираме аналогично какво означава $f$
% да е изчислима с машина на Тюринг $\M$, като тук за да изчислим $f(n_1,\dots,n_k)$, входната лента има вида:
% \[\dots \blank \blank \underbrace{11\dots 1}_{n_1}\blank  \underbrace{11\dots 11}_{n_2} \blank \dots \blank  \underbrace{11\dots 11}_{n_k} \blank\blank\dots\]

\begin{thm}
  За всяко $k$, съществуват функции от вида $f:\Nat^k\to\Nat$, които не са изчислими с МТ.
\end{thm}
\begin{proof}
  Знаем, че всяка МТ може да се кодира с естествено число.
  Това означава, че съществуват изброимо безкрайно много различни машини на Тюринг.
  Също така, ние знаем, че съществуват неизброимо много различни функции от вида $f:\Nat^k\to\Nat$.
  Заключаваме, че със сигурност съществуват функции, които не са изчислими с МТ.
\end{proof}



\section{Разрешими и полуразрешими езици}

\begin{itemize}
\item
  \marginpar{semi-decidable languages}
  {\bf Полуразрешими} са тези езици, които се разпознават от машина на Тюринг.
\item
  \marginpar{decidable languages}
  {\bf Разрешими} са тези езици, които се разпознават от машина на Тюринг, която {\em спира върху всеки вход}.
\end{itemize}

Ще разгледаме два основни примера за езици. Единият ще бъде за език, който не е полуразрешим, а другият за език, който е 
полуразрешим, но не е разрешим.

\subsection*{Диагоналният език $L_d$}

Нека $\omega_0,\omega_1,\dots,\omega_n,\dots$ е каноничната подредба на всички думи над азбуката $\{0,1\}$.
Да разгледаме безкрайната таблица $\{a_{ij} \mid i,j \in \Nat\}$, където:
\begin{align*}
  a_{ij} = 
  \begin{cases}
    1, & \text{ ако } \omega_i \in L(\M_j), \\
    0, & \text{ ако } \omega_i \not\in L(\M_j).
  \end{cases}
\end{align*}
Идеята е да вземем $0$-ите по диагонала на тази таблица.

\begin{framed}
  Езикът 
  $L_d = \{w_i \mid w_i \not\in L(\M_i)\}$ не се разпознава от MT,
  т.е. $L_d$ {\bf не} е полуразрешим.
\end{framed}
Да допуснем, че $L_d$ се разпознава от МТ, т.е. $L_d = \L(\M_i)$, за някоя МТ с код $i$.
Тогава:
\begin{align*}
  & \omega_i \in L_d \implies \omega_i \in \L(\M_i) \implies \omega_i \not\in L_d,\\
  & \omega_i \not\in L_d \implies \omega_i \not\in \L(\M_i) \implies \omega_i \in L_d.
\end{align*}
Достигаме до противоречие.

\begin{remark}
  Да обърнем внимание, че $\bar{L}_d = \{\omega_i \mid \omega_i \in \L(\M_i)\}$ е полуразрешим език.
\end{remark}

\subsection*{Универсалният език $L_u$}

Да разгледаме езика $L_u = \{\pair{\M,\omega} \mid \omega\in \L(\M)\}$.

\begin{lemma}
  $L_u$ е полуразрешим език.
\end{lemma}

\begin{lemma}
  $\bar{L}_u = \{\pair{\M,\omega} \mid \omega\not\in \L(\M)\}$ {\bf не} е полуразрешим език.
\end{lemma}

\begin{framed}
  \begin{thm}
    Универсалният език $L_u$ е полуразрешим, но {\bf не} е разрешим.
  \end{thm}
\end{framed}

Да допуснем, че $L_u$ е разрешим.
\begin{itemize}
\item 
  Вход думата $\omega$;
\item
  Намираме каноничния индекс $i$ на $\omega$, т.е. $\omega_i = \omega$;
\item
  Намираме машината на Тюринг $\M_i$ с код $i$;
\item
  Симулираме $\pair{\M_i,\omega_i}$. % върху $\M$.
\end{itemize}

Така получваме, че:
\[\omega_i\in \bar{L}_d \iff \M_i\text{ приема }\omega_i \iff \pair{\M_i,\omega_i} \in L_u.\]
Заключаваме, че $\bar{L}_d$ е разрешим език, което е противоречие.

% \section{Проблемът за съответствие на Пост (PCP)}

% \subsection*{MPCP}



\section{Критерий за разрешимост}
\marginpar{\cite{hopcroft1}, стр. 188}

Нека $\Ss$ е множество от полуразрешими езици над азбуката $\{0,1\}$.
Ще казваме, че $\Ss$ е свойство на полуразрешимите езици.
$\Ss$ е тривиално свойство, ако $\Ss = \emptyset$ или $\Ss$ съдържа точно всички полуразрешими езици.
Нека $L_\Ss = \{\pair{\M} \mid \L(\M) \in \Ss\}$.

\begin{thm}[Райс-Успенски]
  \index{Райс-Успенски}
  Всяко нетривиално свойство $\Ss$ на полуразрешимите езици е неразрешимо.
\end{thm}
\begin{proof}
  \marginpar{Цел: да сведем ефективно $L_u$ към $L_\Ss$}
  Без ограничение на общността, нека $\emptyset \not\in \Ss$.
  Понеже $\Ss$ е нетривиално свойство, да разгледаме $L \in \Ss$,
  като $\M_L$ е машина на Тюринг, за която $\L(\M_L) = L$.
  Да разгледаме алгоритъм $A$, който за дадена дума $\pair{\M,w}$
  връща код на машина на Тюринг $\M'$, която работи по следния начин:
  \begin{itemize}
  \item
    \marginpar{Неформално описваме функцията $\delta$ за $\M'$}
    имаме вход - произволна дума $x$;
  \item
    \marginpar{$\M$ и $w$ са предварително фиксирани. Кодът на $\M'$ зависи от тях}
    първоначално не обръщаме внимание на $x$, а питаме дали $\pair{\M,w} \in L_u$, т.е. дали $\M$ приема думата $w$;
    \begin{itemize}
    \item 
      ако съществува стъпка $s$, за която $\pair{\M,w} \in L^s_u$, то симулираме $\M_L$ върху входната дума $x$;
      в този случай получаваме $\L(\M') = L$;
    \item
      ако не съществува стъпка $s$, за която $\pair{\M,w} \in L^s_u$, то 
      няма да разпознаем нито една дума;
      в този случай получаваме $\L(\M') = \emptyset$.      
    \end{itemize}
  \end{itemize}
  От всичко това следва, че ако $A(\pair{\M,w}) = \pair{\M'}$, то:
  \begin{align*}
    & \pair{\M,w} \in L_u \implies (\exists s)[\pair{\M,w} \in \L^s_u] \implies \L(\M') = L \implies \L(\M') \in \Ss,\\
    & \pair{\M,w} \not\in L_u \implies (\forall s)[\pair{\M,w} \not\in \L^s_u] \implies \L(\M') = \emptyset \implies \L(\M') \not\in \Ss.
  \end{align*}
  Да допуснем, че $\Ss$ е разрешимо множество от полуразрешими езици.
  Тогава от еквивалентността,
  \[\pair{\M,w} \in \L_u \iff \pair{\M'} \in L_\Ss,\]
  получаваме, че $\L_u$ е разрешимо множество, което е противоречие.
\end{proof}

\begin{cor}
  Следните свойства $\Ss$ на полуразрешимите множества {\bf не} са разрешими:
  \begin{enumerate}[a)]
  \item 
    празнота, т.е. $\Ss = \{\pair{\M} \mid \L(\M) = \emptyset\}$;
  \item
    крайност, т.е. $\Ss = \{\pair{\M} \mid |\L(\M)| < \infty\}$;
  \item
    регулярност, т.е. $\Ss = \{\pair{\M} \mid (\exists \text{ рег. израз }r)[\L(\M) = \L(r)]\}$;
  \item
    безконтекстност, т.е. $\Ss = \{\pair{\M} \mid (\exists\text{ безконт. грам. }G)[\L(\M) = \L(G)]\}$.
  \end{enumerate}
\end{cor}

\subsection*{Валидни и невалидни изчисления на машини на Тюринг}

\begin{lemma}
  \marginpar{\cite{hopcroft1}, стр. 201}
  Множеството от валидни изчисления на машина на Тюринг $\M$ е сечението на два безконтекстни езика $L_1$ и $L_2$.
  Освен това, граматиките на $L_1$ и $L_2$ могат ефективно да бъдат построени от $\M$.
\end{lemma}
\begin{hint}
  Да разгледаме езика
  \[L_3 = \{\alpha\#\beta^R \mid \alpha \vdash_\M \beta\}.\]
  Лесно е да построим стеков автомат $P_3$, който разпознава езика $L_3$.
  Четем буквата $X$. Тогава:
  \begin{itemize}
  \item 
    ако $\delta_\M(q,X) =(p,Y,R)$, то слагаме $Yp$ на върха на стека;
  \item
    ако $\delta_\M(q,X) =(p,Y,L)$, то ако $Z$ е върха на стека, заменяме $Z$ с $pZY$;
  \end{itemize}
  Аналогично разглеждаме безконтекстния език
  \[L_4 = \{\alpha^R\#\beta \mid \alpha \vdash_\M \beta\}.\]
  Сега можем да дефинираме езиците
  \begin{align*}
    & L_1 = (L_3\#)^\star(\{\varepsilon\}\cup \Gamma^\star F \Gamma^\star\#)\\
    & L_2 = q_0\Sigma^\star(L_4\#)^\star(\{\varepsilon\}\cup \Gamma^\star F \Gamma^\star\#),
  \end{align*}
  за които е ясно, че са безконтекстни.
\end{hint}

\begin{thm}
  Въпросът дали две произволни безконтекстни граматики $G_1$ и $G_2$, $\L(G_1) \cap \L(G_2) = \emptyset$,
  е неразрешим.
\end{thm}

\begin{lemma}
  Множеството от невалидни изчисления на машина на Тюринг е безконтекстен език.
\end{lemma}

\begin{thm}
  Въпросът дали за произволна безконтекстна граматика $G$, $\L(G) = \Sigma^\star$,
  е неразрешим.
\end{thm}

\begin{cor}
  Нека $G_1$ и $G_2$ са произволни безконтекстни граматики, а $r$ е произволен регулярен израз.
  Следните проблеми са неразрешими:
  \begin{enumerate}
  \item 
    $\L(G_1) = \L(G_2)$;
  \item
    $\L(G_2) \subseteq \L(G_1)$;
  \item
    $\L(G_1) = \L(r)$;
  \item
    $\L(r) \subseteq \L(G_1)$.
  \end{enumerate}
\end{cor}

\section{Критерии за полуразрешимост}

\begin{lemma}
  Нека $\Ss$ е свойство на полуразрешимите езици.
  Ако съществува безкраен език $L_0 \in \Ss$, който няма крайно подмножество в $\Ss$,
  то $L_\Ss$ не е полуразрешим език.  
\end{lemma}
\begin{hint}
  Нека $L_0 = \L(\M_0)$.
  Ще опишем алгоритъм, който при вход дума $\pair{\M,\omega}$,
  извежда код на машина на Тюринг $\M'$, която работи така:
  \begin{itemize}
  \item 
    вход думата $\alpha$;
  \item
    за $\abs{\alpha}$ стъпки симулираме $\M$ върху $\omega$.
    \begin{itemize}
    \item 
      ако $\M$ приема $\omega$ за $\leq \abs{x}$ стъпки, то симулираме $\M_0$ върху $\alpha$;
    \item 
      ако $\M$ не приема $\omega$ за $\leq \abs{x}$ стъпки, то зацикляме и нищо не връщаме.
    \end{itemize}
  \end{itemize}

  Така получаваме, че 
  \begin{align*}
    \L(\M') = 
    \begin{cases}
      \{\alpha \in L_0 \mid \abs{\alpha} < k\}, & \M\text{ приема }\omega\\
      L, & \M\text{ не приема }\omega,
    \end{cases}
  \end{align*}
  където $k$ е минималната стъпка, при която $\M$ приема $\omega$.
  
  Заключаваме, че 
  \[\pair{\M,\omega} \not\in L_u \iff \L(\M') \in \Ss.\]
  Това означава, че ефективно можем да сведем въпрос за принадлежност в $\bar{L}_u$
  към въпрос за принадлежност в $L_\Ss$.
  Следователно, ако $L_\Ss$ е полуразрешим език, то $\bar{L}_u$ е полуразрешим език, което е противоречие.
\end{hint}

\begin{cor}
  Следните езици {\bf не} са полуразрешими:
  \begin{itemize}
  \item 
    $L = \{\pair{\M} \mid \abs{\L(\M)} = \infty\}$;
  \item
    $L = \{\pair{\M} \mid \L(\M) = \Sigma^\star\}$;
  \item
    $L = \{\pair{\M} \mid \L(\M)\text{ не е разрешим}\}$;
  \item
    $L = \{\pair{\M} \mid \L(\M)\text{ не е полуразрешим}\}$;
  \item
    $L = \{\pair{\M} \mid \L(\M)\text{ не е регулярен}\}$.
  \end{itemize}
\end{cor}

\begin{lemma}
  Нека $L_1$ е език в $\Ss$ и нека $L_2$ е полуразрешимо множество, разширяващо $L_1$, и $L_2 \not\in\Ss$.
  Тогава $L_\Ss$ не е полуразрешимо.
\end{lemma}
\begin{hint}
  Нека $L_1 = \L(\M_1)$ и $L_2 = \L(\M_2)$.
  Ще опишем алгоритъм, който при вход дума $\pair{\M,\omega}$,
  извежда код на машина на Тюринг $\M'$, която работи така:
  \begin{itemize}
  \item 
    вход думата $\alpha$;
  \item
    симулираме едновременно две изчисления - $\M_1$ върху $\alpha$ и $\M$ върху $\omega$:
    \begin{itemize}
    \item 
      ако $\M_1$ приеме думата $\alpha$, то обявяваме, че $\M'$ приема $\alpha$ и завършваме.
    \item
      ако достигнем стъпка $s$, за която $\M^s_1$ все още не приема думата $\alpha$,
      но $\M^s$ приема $\omega$, то започваме да симулираме $\M_2$ върху $\alpha$.
      Ако $\M_2$ приеме $\alpha$, то $\M'$ приема $\alpha$.
    \end{itemize}
  \end{itemize}
  
  Получаваме, че:
  \begin{align*}
    \L(\M') = 
    \begin{cases}
      L_2, & \M\text{ приема }\omega\\
      L_1, & \M\text{ не приема }\omega.
    \end{cases}
  \end{align*}
  Заключаваме, че:
  \[\pair{\M,\omega} \not\in L_u \iff \L(\M') \in \Ss.\]
  Това означава, че ефективно можем да сведем въпрос за принадлежност в $\bar{L}_u$
  към въпрос за принадлежност в $L_\Ss$.
  Следователно, ако $L_\Ss$ е полуразрешим език, то $\bar{L}_u$ е полуразрешим език, което е противоречие.  
\end{hint}

\begin{cor}
  Следните езици {\bf не} са полуразрешими:
  \begin{itemize}
  \item 
    $L = \{\pair{\M} \mid \L(\M) \text{ е регулярен} \}$;
  \item
    $L = \{\pair{\M} \mid \L(\M) \text{ е безконтекстен} \}$;
  \item
    $L = \{\pair{\M} \mid \L(\M) \text{ е разрешим} \}$;
  \item
    $L = \{\pair{\M} \mid \abs{\L(\M)} = 42\}$;
  \end{itemize}
\end{cor}


% \section{Проблеми за безконтекстни езици}

% \begin{lemma}
%   Нека е дадена $\M = \TM$.
%   Тогава езикът 
%   \[L = \{\alpha\sharp\beta^R \mid \alpha,\beta \in \Gamma^\star Q \Gamma^\star\ \&\  \alpha \vdash_\M \beta\}\]
%   е безконтекстен.
% \end{lemma}
% \begin{proof}
%   Ще покажем, че съществува стеков автомат $P$, за който $\L_S(P) = L$.
%   Четем буквата $X$. Тогава:
%   \begin{itemize}
%   \item 
%     ако $\delta_\M(q,X) =(p,Y,R)$, то слагаме $Yp$ на върха на стека;
%   \item
%     ако $\delta_\M(q,X) =(p,Y,L)$, то ако $Z$ е върха на стека, заменяме $Z$ с $pZY$;
%   \end{itemize}
% \end{proof}

% \begin{lemma}
%   Нека е дадена $\M = \TM$.
%   Тогава езикът 
%   \[L = \{\alpha\sharp\beta^R \mid \alpha,\beta \in \Gamma^\star Q \Gamma^\star\ \&\  \alpha \not\vdash_\M \beta\}\]
%   е безконтекстен.
% \end{lemma}


% \begin{thm}
%   Неразрешим е проблемът за проверка дали при дадени две произволни безконтекстни граматики $G_1$ и $G_2$,
%   $\L(G_1) \cap \L(G_2) = \emptyset$.  
% \end{thm}

% \begin{thm}
%   Неразрешим е проблемът за проверка дали при дадена произволна безконтекстна граматика $G$,
%   $\L(G) = \Sigma^\star$.  
% \end{thm}


% \section{Въпроси}

% Вярно ли е, че следният проблем е {\em разрешим}:
% \begin{itemize}
% \item
%   за произволна безконтекстна граматика $G$, проверява дали $\L(G) = \emptyset$?
% \item
%   за произволна безконтекстна граматика $G$, проверява дали $\L(G) = \Sigma^\star$?
% \item
%   за произволни безконтекстни граматики $G_1$ и $G_2$, проверява дали $\L(G_1) \cap \L(G_2) = \emptyset$?
% \item
%   за произволни безконтекстни граматики $G_1$ и $G_2$, проверява дали $\L(G_1) \cap \L(G_2) = \Sigma^\star$?
% \item
%   за произволни безконтекстни граматики $G_1$ и $G_2$, проверява дали $\L(G_1) = \L(G_2)$?
% \item
%   за произволни безконтекстни граматики $G_1$ и $G_2$, проверява дали $\L(G_1) \subseteq \L(G_2)$?
% \item
%   за произволна безконтекстна граматика $G$ и произволен регулярен израз $r$,
%   проверява дали $\L(G) = \L(r)$?
% \item
%   за произволна безконтекстна граматика $G$ и произволен регулярен израз $r$,
%   проверява дали $\L(G) \subseteq \L(r)$?
% \item
%   за произволна безконтекстна граматика $G$ и произволен регулярен израз $r$,
%   проверява дали $\L(r) \subseteq \L(G)$?
% \item
%   за произволни безконтекстни граматики $G_1$ и $G_2$, проверява дали $\L(G_1) \subseteq \L(G_2)$ 
%   е безконтекстен език ?
% \item
%   за произволна безконтекстна граматика $G$, проверява дали $\Sigma^\star \setminus \L(G)$
%   е безконтекстен език ?
% \item
%   за произволна безконтекстна граматика $G$, проверява дали $\L(G)$ е регулярен език?
% \end{itemize}

\section{Неограничени граматики}
\index{граматика!неограничена}

\begin{dfn}
  \marginpar{(стр. 220 от \cite{hopcroft1})}
  \marginpar{На англ. unrestricted grammar}
  \marginpar{Според йерархията на Чомски, това е граматика от тип 0}
  Граматиката $G = (V,\Sigma,R,S)$
  се нарича неограничена граматика, 
  ако правилата $R$ са от вида $\alpha \to \beta$,
  където $\alpha,\beta \in (V\cup\Sigma)^\star$.
\end{dfn}

\begin{lemma}
  За всеки полуразрешим език $L$, $L = \L(G)$, за някоя неограничена граматика $G$.  
\end{lemma}
\begin{proof}
  Нека $L = \L(\M)$, където $\M = \TM$ е детерминистична машина на Тюринг,
  като искаме лентата да е безкрайна само отдясно и входната дума $\alpha$ е
  поставена в началото на лентата.
  Ще построим граматика $G$, която 
  $G = \CFG$, където 
  \[V = ((\Sigma\cup\{\varepsilon\})\times\Gamma) \cup \{A_1,A_2,A_3\}.\]
  Правилата на $G$ са следните:
  \begin{enumerate}[1)]
  \item 
    $A_1 \to sA_2$;
  \item
    $A_2 \to [a,a]A_2$, за всяка $a\in\Sigma$;
  \item
    $A_2 \to A_3$;
  \item
    $A_3 \to [\varepsilon,\blank]A_3$;
  \item
    $A_3 \to \varepsilon$;
  \item
    $q[a,X] \to [a,Y]p$, за всяка $a \in \Sigma\cup\{\varepsilon\}$, всяко $q\in Q$, $X,Y \in\Gamma$, 
    за които $\delta(q,X) = (p,Y,R)$;
  \item
    $q[a,X] \to p[a,Y]$, за всяка $a \in \Sigma\cup\{\varepsilon\}$, всяко $q\in Q$, $X,Y \in\Gamma$, 
    за които $\delta(q,X) = (p,Y,N)$;
  \item
    $[b,Z]q[a,X] \to p[b,Z][z,Y]$, за всяко $X,Y,Z \in \Gamma$, $a,b\in\Sigma\cup\{\varepsilon\}$, $q\in Q$,
    за които $\delta(q,X) = (p,Y,L)$;
  \item
    $[a,X]q \to qaq$, $q[a,X] \to qaq$, $q \to \varepsilon$, за всяко $a\in\Sigma\cup\{\varepsilon\}$, $X\in\Gamma$,
    и $q \in F$.
  \end{enumerate}
  
  Лесно се вижда, че, използвайки правилата 1) и 2), за всяко $n$, имаме
  \[A_1 \to^\star s[a_1,a_1]\cdots[a_n,a_n]A_2,\]
  където $a_i \in \Sigma$.

  Нека сега да приемем, че $\M$ приема думата $\alpha = a_1\cdots a_n$.
  Това означава, че за някое $m$, $\M$ използва не повече от $m$ клетки от лентата отдясно на входната дума.
  Ясно е, че имаме
  \[A_1 \to^\star s[a_1,a_1]\cdots[a_n,a_n][\varepsilon,\blank]^m.\]
  Оттук нататък, можем да използваме само правилата 6), 7), 8), докато не срещнем финално състояние.
  С индукция по броя на стъпки в $\M$, можем да докаже, че ако е изпълнено
  $(\varepsilon,s,a_1\cdots a_n) \vdash^\star_\M (X_1\cdots X_{r-1},q,X_r\cdots X_l)$, 
  то \[s[a_1,a_1]\dots[a_n,a_n][\varepsilon,\blank]^m \rightarrow^\star_G [a_1,X_1]\cdots[a_{r-1},X_{r-1}]q[a_r,X_r]\cdots[a_{n+m},X_{n+m}],\]
  където $a_1,\dots,a_n \in \Sigma$, $a_{n+1},\dots,a_{n+m} = \varepsilon$, $X_1,\dots,X_{n+m} \in \Gamma$ и
  $X_{l+1} = X_{l+2} = \dots = X_{n+m} = \blank$.
  
  Най-накрая, ако $q \in F$, то можем да използваме правилата от 9) и да докажем, че
  \[[a_1,X_1]\cdots[a_{t-1},X_{t-1}]q[a_t,X_t]\cdots[a_{n+m},X_{n+m}] \rightarrow^\star_G a_1\cdots a_n.\]
  
  Така доказахме, че ако $\alpha \in \L(\M)$, то $\alpha \in \L(G)$, т.е. $\L(\M) \subseteq \L(G)$.
  За да докажем обратната посока, трябва да направим подобни разсъждения.
\end{proof}

\begin{lemma}
  Ако $L = \L(G)$, където $G$ е неограничена граматика, то $L$ е полуразрешим език.
\end{lemma}
\marginpar{Доказателствата в \cite{hopcroft1} и \cite{papadimitriou} са различни}
\begin{proof}
  $\M$ ще бъде недетерминистична машина с три ленти.
  \begin{enumerate}[1)]
  \item
    Записваме входната дума $\omega$ на първата лента на $\M$.
    Тя никога не се променя.
  \item
    На втората лента ще имаме думата $\gamma \in (V\cup\Sigma)^\star$.
    В началото $\gamma := S$.
  \item 
    Недетерминистично избираме правило $\alpha \to \beta$ от граматиката $G$.
  \item
    Недетерминистично избираме $\gamma_0,\gamma_1 \in (V\cup\Sigma)^\star$, за които 
    $\gamma = \gamma_0\alpha\gamma_1$.
    Тогава $\gamma := \gamma_0\beta\gamma_1$.
    Ако няма такива $\gamma_0$ и $\gamma_1$, то $\M$ ,,зацикля'' - текущият опит за извеждане на $\omega$ пропада.
  \item
    Сравняваме съдържанието на първите две ленти, т.е. проверяваме дали $\omega = \gamma$.
    Ако $\omega = \gamma$, то спираме и казваме, че $\M$ разпознава думата $\omega$.
    Ако $\omega \neq \gamma$, то се връщаме на стъпка 3).
  \end{enumerate}

  \begin{algorithm}[H]
  \caption{}
%  \label{alg:}
  \begin{algorithmic}[1]
    \State $\gamma:= S$
    \ForAll{$\alpha\to\beta \in R$}
    \If{$(\exists \gamma_0,\gamma_1\in (V\cup\Sigma)^\star)[\gamma = \gamma_0\alpha\gamma_1]$}
    \State $\gamma := \gamma_0\beta\gamma_1$
    \Else ...
    \EndIf
    \EndFor
  \end{algorithmic}
\end{algorithm}

\end{proof}

\begin{example}
  Граматика за $L = \{a^nb^nc^n \mid n\in\Nat\}$.
\end{example}


\section*{Библиография}

\begin{itemize}
\item 
\item
\item

\end{itemize}

%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "EAI"
%%% End: 
