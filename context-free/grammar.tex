\section{Безконтекстни граматики}

\index{граматика!безконтекстна}
\mynote{В \cite{papadimitriou} дефиницията е различна. Там $\Sigma \subseteq V$. На англ. {\em context-free grammar}. Други срещани наименования на български са {\em контекстно-свободна}, {\em контекстно-независима}.}

В Раздел \ref{sect:regular-grammar} въведохме понятието граматика. След това видяхме как можем да опишем регулярните езици
със специален вид граматики, които нарекохме регулярни граматики.
Сега ще разгледаме още един вид граматики, които описват по-широк клас от езици.

\begin{itemize}
\item 
  Една граматика $G = (V, \Sigma, R, S)$ се нарича {\bf безконтекстна}, ако 
  имаме ограничението, че $R \subseteq V\times (V\cup\Sigma)^\star$.
\item
  \index{език!безконтекстен}
  $L$ се нарича {\bf безконтекстен език}, ако съществува безконтекстна граматика $G$, за която 
  $L = \L(G) = \{\omega \in \Sigma^\star \mid S \derive{\star} \omega\}$.
\end{itemize}

\begin{remark}
  Очевидно е, че всяка регулярна граматика е безконтекстна. Следователно, 
  {\em всеки регулярен език е безконтекстен.}
\end{remark}


За произволна безконтекстна граматика $G$, дефинираме релацията $X \yield{\ell} \alpha$, където $X \in V \cup \Sigma$ и $\alpha \in (V\cup\Sigma)^\star$, по следния начин:
\mynote{Тук е добре да се нарисува картинка. Да се обясни, че $\yield{\star}$ е аналог на BFS, докато $\derive{\star}$ е аналог на DFS.}
\begin{prooftree}
  \AxiomC{}
  \UnaryInfC{$X \yield{0} X$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$X \to_G \gamma$}
  \UnaryInfC{$X \yield{1} \gamma$}
\end{prooftree}

\begin{prooftree}
  \AxiomC{$X \yield{1} X_1\cdots X_n$}
  \AxiomC{$X_i \yield{\ell_i} \gamma_i\text{ за }i=1,\dots,n$}
  \RightLabel{\scriptsize{($\ell = \max\{\ell_1,\dots,\ell_n\})$}}
  \BinaryInfC{$X \yield{\ell+1} \gamma_1\cdots\gamma_n$}
\end{prooftree}

Нека $\yield{\star}$ е рефлексивното и транзитивно затваряне на релацията $\yield{\ell}$, т.е.
\[X \yield{\star} \gamma \dff (\exists \ell\in\Nat)[X \yield{\ell} \gamma].\]

Ясно е, че $X \yield{\star} \gamma \iff X \derive{\ell} \gamma$.

Да напомним, че дефинирахме език $\L_\A(q)$.
Сега ще дефинираме език $\L_G(A)$, за произволна променлива.
\[\L_G(A) = \{\alpha \in \Sigma^\star \mid A \yield{\star}\alpha\}.\]
\mynote{Това е аналогично на $\L(\A) = \L_\A(\qstart)$.}
Ясно е, че $\L(G) = \L_G(S)$.
Също така, да дефинираме следните апроксимации на $\L_G(A)$.
\[\L^n_G(A) = \{\alpha \in \Sigma^\star \mid A \yield{\leq n} \alpha\}.\]
Ясно е, че $\L_G(A) = \bigcup_{n\geq 0}\L^n_G(A)$.

Следващото твърдение е ключово за решаването на задачи.

\begin{proposition}\label{pr:grammar:yield-approximation}
  Нека $G$ е произволна безконтекстна граматика и $A$ е променлива в $G$.
  Тогава имаме следното:
  \begin{align*}
    \L^0_G(A) & = \emptyset\\
    \L^{\ell+1}_G(A) & = \bigcup\{\{\alpha_1\}\cdot \L^\ell_G(A_1) \cdots \{\alpha_n\} \cdot \L^\ell_G(A_n) \cdot \{\alpha_{n+1}\} \mid A \to_G \alpha_1A_1\cdots\alpha_nA_n\alpha_{n+1}\}
  \end{align*}
  % \[\L^0_G(X) =
  %   \begin{cases}
  %     X, & \text{ ако } X \in \Sigma\\
  %     \emptyset, & \text{ ако } X \in V.
  %   \end{cases}
  % \]
  % \[\L^{\ell+1}_G(X) = \L^\ell_G(X) \cup \bigcup\{\L^\ell_G(X_1)\cdots\L^\ell_G(X_n) \mid X \to_G X_1\cdots X_n\text{ е правило в }G\}.\]
\end{proposition}



Като първи пример нека да видим, че това включване е {\em строго}, т.е. съществува безконтекстен език, който не е регулярен.
Да напомним, че вече видяхме, че езикът $L = \{a^nb^n \mid n\in\Nat\}$ не е регулярен.

\begin{example}
  Да разгледаме безконтекстната граматика $G$ зададена със следните правила:
  \begin{align*}
    & S \to aSb \mid \varepsilon.
  \end{align*}
  Тогава
  \begin{align*}
    & \L^0_G(S) = \emptyset\\
    & \L^1_G(S) = \{a\} \cdot \emptyset \cdot \{b\} \cup \{\varepsilon\} = \{\varepsilon\}\\
    & \L^{2}_G(S) = \{a\} \cdot \{\varepsilon\} \cdot \{b\} \cup \{\varepsilon\} = \{\varepsilon, ab\}\\
    & \L^{3}_G(S) = \{a\} \cdot \{\varepsilon, ab\} \cdot \{b\} \cup \{\varepsilon, ab\} = \{\varepsilon,ab,aabb\} = \{a^nb^n \mid n < \ell\}\\
    & \vdots
  \end{align*}
  Лесно се съобразява, че
  \[\L^\ell_G(S) = \{a^nb^n \mid n < \ell\}.\]
  Заключаваме, че:
  \[\L(G) = \L_G(S) = \bigcup_{\ell}\L^\ell_G(S) = \{a^nb^n \mid n\in\Nat\}.\]
\end{example}

\begin{example}
  Да разгледаме безконтекстната граматика $G$ зададена със следните правила:
  \begin{align*}
    & S \to aSc\ |\  B\\
    & B \to bBc\ |\ \varepsilon.
  \end{align*}
  Лесно се съобразява, че $\L(G) = \{a^nb^kc^{n+k} \mid n,k\in\Nat\}$.
\end{example}

\begin{example}
  Да разгледаме граматика с правила
  \begin{align*}
    & S \to S + S\ |\ S * S\ |\ (S)\ |\ V\\
    & V \to x\ |\ y\ |\ z
  \end{align*}

  Думата $x * y + z$ има две различни дървета на извод.

  \begin{framed}
    \qtreecenterfalse
    \Tree [.$S$ [.$S$ [.$V$ $x$ ] ] $*$ [.$S$ [.$S$ [.$V$ $y$ ] ] $+$ [.$S$ [.$V$ $z$ ] ] ] ]
    \hskip 0.4in
    \Tree [.$S$ [.$S$ [.$S$ [.$V$ $x$ ] ] $*$ [.$S$ [.$V$ $y$ ] ] ]  $+$  [.$S$ [.$V$ $z$ ] ] ]
  \end{framed}
  
  
  Да разгледаме граматика с правила
  \begin{align*}
    & S \to E + S\ |\ E\\
    & E \to V * E\ |\ V\ |\ (S) * E\ |\ (S)\\
    & V \to x\ |\ y\ |\ z
  \end{align*}
  Сега думата $x * y + z$ има само едно дърво на извод.

  \begin{framed}
    \Tree [.$S$ [.$E$ [.$V$ $x$ ] $*$ [.$E$ [.$V$ $y$ ] ] ] $+$ [.$S$ [.$E$ [.$V$ $z$ ] ] ] ]
  \end{framed}
\end{example}

\begin{example}
  \begin{align*}
    & S \to \texttt{if } S \texttt{ then } S \texttt{ else }S\ |\ \texttt{ if }S \texttt{ then }S\ |\ V\\
    & V \to x\ |\ y\ |\ z
  \end{align*}

  Ние искаме следната граматика:
  \begin{align*}
    & S \to M\ |\ U\\
    & M \to \texttt{if } S \texttt{ then } M \texttt{ else }M\ |\ X\\
    & U \to \texttt{if } S \texttt{ then } S\ |\ \texttt{if } S \texttt{ then } M \texttt{ else }U
  \end{align*}
\end{example}

\begin{example}
  Да разгледаме граматика с правила
  \begin{align*}
    & S \to E\\
    & E \to E + P\ |\ P\\
    & P \to P * N\ |\ N\\
    & N \to (E)\ |\ a.
  \end{align*}
\end{example}

\begin{framed}
  \begin{thm}
    Всеки регулярен език е безконтекстен.
  \end{thm}
\end{framed}
\begin{proof}
  Ще направим индукция по построението на регулярните езици.
  \begin{itemize}
  \item
    Всеки от езиците $\emptyset$, $\{\varepsilon\}$ и $\{a\}$, за всяка буква $a \in \Sigma$ е безконтекстен.
  \item
    Нека $L_1$ и $L_2$ са безконтекстни езици. Тогава:
    \begin{itemize}
    \item
      $L_1 \cup L_2$ е безконтекстен език.
    \item
      $L_1 \cdot L_2$ е безконтекстен език.
    \item
      $L^\star_1$ е безконтекстен език.
    \end{itemize}
  \end{itemize}
\end{proof}


% \begin{proposition}
%   \label{pr:grammar:concat}
%   Ако $\alpha_1 \derive{n_1} \beta_1, \dots, \alpha_k \derive{n_k} \beta_k$, тогава
%   \[\alpha_1\cdots\alpha_k \derive{n} \beta_1\cdots\beta_k,\]
%   където $n = \sum^k_{i=1} n_i$.
% \end{proposition}
% \begin{proof}
%   Индукция по $k \geq 1$.
%   \begin{itemize}
%   \item
%     За $k = 1$ е очевидно. В този случай $n_1 = n$.
%   \item
%    Нека $k > 1$. Тогава от И.П. за $k-1$ имаме, че
%    $\alpha_1\cdots\alpha_{k-1} \derive{n'} \beta_1\cdots\beta_{k-1}$ и $n' = \sum^{k-1}_{i=1} n_i$.
%    От \Proposition{grammar:add} имаме, че
%    \[\alpha_1\cdots\alpha_{k-1}\alpha_{k} \derive{n'} \beta_1\cdots\beta_{k-1}\alpha_k.\]
%    Понеже $\alpha_k \derive{n_k} \beta_k$, отново от \Proposition{grammar:add} получаваме, че
%    \[\beta_1\cdots\beta_{k-1}\alpha_k \derive{n_k} \beta_1 \cdots \beta_{k-1}\beta_k.\]
%    Сега обединяваме двата извода и получаваме, че
%    \[\alpha_1\cdots\alpha_{k} \derive{n} \beta_1\cdots\beta_k,\]
%    където $n = \sum^k_{i=1} n_i$.
%   \end{itemize}
% \end{proof}

% \begin{framed}
  \begin{proposition}
    \label{pr:grammar:divide}
    Нека $G$ е безконтекстна граматика и нека $X_1\cdots X_k \derive{n}_G \beta$, където $X_i \in V \cup \Sigma$.
    Тогава съществуват думи $\beta_1,\dots,\beta_k$, такива че за $i = 1,\dots, k$ е изпълнено, че
    $X_i \derive{n_i} \beta_i$, където $\beta = \beta_1\cdots \beta_k$ и $n = \sum^k_{i = 1}n_i$.
  \end{proposition}
% \end{framed}
% \begin{proof}
%   Индукция по $n$.
%   \begin{itemize}
%   \item
%     Нека $n = 0$. Тогава $\beta = \alpha_1 \cdots \alpha_k$ и е ясно, че в този случай $\beta_i = \alpha_i$ и $n_i = 0$.
%   \item
%     Нека $n > 0$ и $\alpha_1\cdots \alpha_k \derive{n} \beta$. Тогава за някое $i$, $\alpha_i \to_G \alpha'_i$ и
%     като приложим \Proposition{grammar:add} получаваме, че
%     \[\alpha_1\cdots\alpha_i\cdots\alpha_k \to_G \alpha_1\cdots\alpha'_i\cdots\alpha_k.\]
%     Според дефиницията на релацията $\derive{n}$ имаме, че
%     \[\alpha_1\cdots\alpha'_i\cdots\alpha_k \stackrel{n-1}{\to}_G \beta.\]
%     От И.П. получаваме, че съществуват думи $\beta_1,\dots,\beta_k$, такива че $\beta = \beta_1 \cdots \beta_k$
%     и $\alpha_j \derive{n_j} \beta_j$ за $j \neq i$ и $\alpha'_i \derive{n'_i} \beta_i$, като
%     \[n-1 = n'_i + \sum_{j\neq i} n_j.\]
%     Понеже имаме, че $\alpha_i \to_G \alpha'_i \derive{n'_i}\beta_i$,
%     то е ясно, че за $n_i = n'_i + 1$ имаме $\alpha_i \derive{n_i} \beta_i$ и
%     \[n = \sum^{k}_{i=1} n_i.\]
%   \end{itemize}
% \end{proof}




%%% Local Variables: 
%%% mode: latex
%%% TeX-master: "../eai"
%%% End: 
