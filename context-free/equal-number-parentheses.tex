\subsection{Равен брой леви и десни скоби}

\mynote{За да се приближим малко до по-реален пример, можете да си мислите, че тук искаме да разпознаем думите с равен брой леви и десни скоби, като например интерпретираме $a$ като символа $\texttt{\{}$ и
  $b$ като символа $\texttt{\}}$.}
Нека за по-голяма яснота да положим
\begin{align*}
  & \texttt{left}(\alpha) \df \card{\alpha}{a} & \comment{\text{брой срещания на $a$ в $\alpha$}}\\
  & \texttt{right}(\alpha) \df \card{\alpha}{b} & \comment{\text{брой срещания на $b$ в $\alpha$}}
\end{align*}

\begin{problem}
  \label{prob:nanb}
  Нека $\omega$ е произволна дума над азбуката $\{a,b\}$. 
  Тогава:
  \begin{enumerate}[a)]
  \item 
    ако $\texttt{left}(\omega) = \texttt{right}(\omega) + 1$, то съществуват думи $\omega_1$, $\omega_2$, за които е изпълнено:
    \begin{itemize}
    \item 
      $\omega = \omega_1 a \omega_2$;
    \item
      $\texttt{left}(\omega_1) = \texttt{right}(\omega_1)$;
    \item
      $\texttt{left}(\omega_2) = \texttt{right}(\omega_2)$.
    \end{itemize}
  \item
    ако $\texttt{right}(\omega) = \texttt{left}(\omega) + 1$, то съществуват думи $\omega_1$, $\omega_2$, за които е изпълнено:
    \begin{itemize}
    \item 
      $\omega = \omega_1 b \omega_2$;
    \item
      $\texttt{left}(\omega_1) = \texttt{right}(\omega_1)$;
    \item
      $\texttt{left}(\omega_2) = \texttt{right}(\omega_2)$.
    \end{itemize}
  \end{enumerate}
\end{problem}
\begin{hint}
  \mynote{Другият случай е аналогичен}
  Ще се съсредоточим върху случая, когато $\omega$ е дума, за която $\texttt{left}(\omega) = \texttt{right}(\omega) + 1$.
  Ще докажем а) с индукция по дължината на думата.
  \begin{itemize}
  \item 
    $\abs{\omega} = 1$. Тогава $\omega_1 = \omega_2 = \varepsilon$ и $\omega = a$.
  \item
    Да приемем, че твърдението а) е вярно за думи с дължина $\leq n$.
  \item
    $\abs{\omega} = n+1$. Ще разгледаме два случая, в зависимост от първия символ на $\omega$.
    \begin{itemize}
    \item 
      Случаят $\omega = a\omega'$ е очевиден. (Защо?)
    \item
      Интересният случай е $\omega = b^i ba \omega'$, за някое $i$.
      % Тогава $\omega = \texttt{]}^{i+1}\texttt{[}\omega'$, за някое $i \in \Nat$.
      Да разгледаме думата $\omega''$, която се получава от $\omega$
      като премахнем първото срещане на думата $ba$, т.е. 
      $\omega'' = b^i\omega'$ и $\abs{\omega''} = n-1$.
      Понеже от $\omega$ сме премахнали равен брой леви и десни скоби, то
      $\texttt{left}(\omega'') = \texttt{right}(\omega'')+1$.
      Според \IndHyp за $\omega''$ са изпълнени свойствата:
      \begin{itemize}
      \item 
        $\omega'' = \omega''_1 a \omega''_2$;
      \item
        $\texttt{left}(\omega''_1) = \texttt{right}(\omega''_1)$;
      \item
        $\texttt{left}(\omega''_2) = \texttt{right}(\omega''_2)$.
      \end{itemize}
      Понеже $b^i$ е префикс на $\omega''_1$, за да получим обратно $\omega$, трябва 
      да прибавим премахнатата част $ba$ веднага след $b^i$ в $\omega''_1$.
    \end{itemize}
  \end{itemize}
\end{hint}

\begin{problem}
  За произволна дума $\omega \in \{ a,b \}^\star$, 
  докажете, че ако $\texttt{left}(\omega) > \texttt{right}(\omega)$, то съществуват думи $\omega_1$ и $\omega_2$,
  за които са изпълнени свойствата:
  \begin{itemize}
  \item 
    $\omega = \omega_1 a \omega_2$;
  \item
    $\texttt{left}(\omega_1) \geq \texttt{right}(\omega_1)$;
  \item
    $\texttt{left}(\omega_2) \geq \texttt{right}(\omega_2)$.
  \end{itemize}
\end{problem}

\begin{framed}
  \begin{problem}
    Да се докаже, че езикът $L = \{\ \alpha \in \{a,b\}^\star\mid \texttt{left}(\alpha) = \texttt{right}(\alpha)\ \}$
    е безконтекстен.
  \end{problem}  
\end{framed}
\begin{proof}
  \mynote{Алтернативна граматика за езика $L$ е
    \[S \to \varepsilon\ |\ a S b \ |\ b S a\ |\ SS.\]}
  Една възможна граматика $G$ е следната: 
  \[S \to a  S b S\ |\ b S a S\ |\ \varepsilon.\]
  
  Като следствие от \Problem{nanb} може лесно да се изведе, че за думи $\omega$, за които $\texttt{left}(\omega) = \texttt{right}(\omega)$,
  е изпълнено следното:
  \begin{enumerate}[a)]
  \item 
    ако $\omega = a\omega'$, то са изпълнени свойствата:
    \begin{itemize}
    \item 
      $\omega = a \omega_1 b \omega_2$;
    \item
      $\texttt{left}(\omega_1) = \texttt{right}(\omega_1)$;
    \item
      $\texttt{left}(\omega_2) = \texttt{right}(\omega_2)$.
    \end{itemize}
  \item
    ако $\omega = b \omega'$, то са изпълнени свойствата:
    \begin{itemize}
    \item 
      $\omega = b \omega_1 a \omega_2$;
    \item
      $\texttt{left}(\omega_1) = \texttt{right}(\omega_1)$;
    \item
      $\texttt{left}(\omega_2) = \texttt{right}(\omega_2)$.
    \end{itemize}
  \end{enumerate}

  Да напомним, че $\L^\ell_G(S) = \{\omega \in \Sigma^\star \mid S \yield{\leq \ell} \omega\}$
  и според \Proposition{grammar:yield-approximation} имаме следната рекурсивна връзка:
  \begin{align*}
    \L^0_G(S) = & \emptyset\\
    \L^{\ell+1}_G(S) = & \{a\} \cdot \L^\ell_G(S) \cdot \{b\} \cdot \L^\ell_G(S)\ \cup\\
                & \{b\} \cdot \L^\ell_G(S) \cdot \{a\} \cdot \L^\ell_G(S)\ \cup\\
                & \{\varepsilon\}.
  \end{align*}
  За коректност на граматиката трябва да докажем, че за всяко $\ell$ е изпълнено следното:
  \begin{equation}
    \label{eq:equal-correctness}
    \L^\ell_G(S) \subseteq \{\omega \in \{a,b\}^\star \mid \texttt{left}(\omega) = \texttt{right}(\omega)\}.
  \end{equation}
  Очевидно е, че \Property{eq:equal-correctness} е изпълнено за $\ell = 0$.
  Да приемем, че \Property{eq:equal-correctness} е изпълнено за някое $\ell$.
  Ще докажем \Property{eq:equal-correctness} за $\ell+1$.
  Да вземем произволна дума $\omega \in \L^{\ell+1}_G(S)$. Имаме три случая.
  \begin{itemize}
  \item
    Ако $\omega = \varepsilon$. Тогава е ясно, че $\texttt{left}(\omega) = \texttt{right}(\omega)$.
  \item
    Ако $\omega \in \{a\} \cdot \L^\ell_G(S) \cdot \{b\} \cdot \L^\ell_G(S)$.
    Тогава $\omega = a \omega_1 b \omega_2$ и $\omega_1, \omega_2 \in \L^\ell_G(S)$.
    От \IndHyp получаваме, че $\texttt{left}(\omega_1) = \texttt{right}(\omega_1)$ и $\texttt{left}(\omega_2) = \texttt{right}(\omega_2)$.
    Заключаваме, че $\texttt{left}(\omega) = \texttt{right}(\omega)$
  \item
    Случаят, когато $\omega = b \omega_1 a \omega_2$, е аналогичен.
  \end{itemize}
  Така доказахме коректност на граматиката, т.е. имаме следното свойство:
  \[\L_G(S) = \bigcup_\ell \L^\ell_G(S) \subseteq \{\omega \in \{a,b\}^\star \mid \texttt{left}(\omega) = \texttt{right}(\omega)\}.\]
  Сега за пълнота на граматиката трябва да докажем, че
  \begin{equation}
    \label{eq:equal-completeness}
    \{\omega \in \{a,b\}^\star \mid \texttt{left}(\omega) = \texttt{right}(\omega)\} \subseteq \L_G(S).
  \end{equation}
  Това ще направим с индукция по дължината на думите.
  Да вземем произволна дума $\omega \in \{a,b\}^\star$ и $\texttt{left}(\omega) = \texttt{right}(\omega)$.
  Да видим защо $\omega \in \L_G(S)$.
  \begin{itemize}
  \item 
    Ако $\omega = \varepsilon$, то е ясно, че $\omega \in \L_G(S)$.
  \item
    Нека $\omega \neq \varepsilon$. Според \Problem{nanb} имаме два случая.
    \begin{itemize}
    \item
      Нека $\omega = a \omega_1 b \omega_2$, $\texttt{left}(\omega_1) = \texttt{right}(\omega_1)$ и $\texttt{left}(\omega_2) = \texttt{right}(\omega_2)$.
      % \begin{align*}
      %   & \texttt{left}(\omega_1) = \texttt{right}(\omega_1)\\
      %   & \texttt{left}(\omega_2) = \texttt{right}(\omega_2).
      % \end{align*}
      Тогава от \IndHyp имаме, че $\omega_1 \in \L_G(S)$ и $\omega_2 \in \L_G(S)$. Заключаваме, че
      \[\omega \in \{a\} \cdot \L_G(S) \cdot \{b\} \cdot \L_G(S) \subseteq \L_G(S).\]
    \item
      Ако $\omega = b \omega_1 a \omega_2$, то с аналогични разсъждения получаваме, че
      \[\omega \in \{b\} \cdot \L_G(S) \cdot \{a\} \cdot \L_G(S) \subseteq \L_G(S).\]
    \end{itemize}
  \end{itemize}
  Така доказахме пълнота на граматиката, т.е. имаме следното свойство:
  \[\{\omega \in \{a,b\}^\star \mid \texttt{left}(\omega) = \texttt{right}(\omega)\} \subseteq \L_G(S).\]
\end{proof}


%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../eai"
%%% End:
